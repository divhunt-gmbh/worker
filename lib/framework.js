const AddonItemCrud={Create(e=null){return new Promise(((t,n)=>{const i=this.addon.Table();null===e&&(e=this.addon.divhunt.Dependency("knex"));const r={};i.fields.forEach((e=>{"id"!==e&&(r[e]=this.Get(e))})),r.created_at=e.fn.now(),r.updated_at=e.fn.now(),e(i.name).insert(r).returning("*").then((([e])=>{Object.entries(e).forEach((([e,t])=>{this.Set(e,t)})),t(this)})).catch((e=>{this.addon.divhunt.LogError(e.message,{operation:"Create",addon:this.addon.GetName(),item:this.Get("id")},e),n(e)}))}))},Update(){},Delete(){}},AddonItemFunctions={Fn(e,...t){return this.addon.FnRun("item."+e,this,...t)}},AddonItemGet={Get(e,t=!0){if(Array.isArray(e)){const n={};return e.forEach((e=>{n[e]=this.Get(e,t)})),n}const n=this.addon.FieldGet(e),i=this.addon.FieldGet("*");if(!n&&!i&&"id"!==e)return null;let r=this.data[e];return n?.get.forEach((e=>{r=e(r,this)})),i?.get.forEach((e=>{r=e(r,this)})),n?.define?r=this.addon.divhunt.DataDefineOne(r,n.define):i?.define&&(r=this.addon.divhunt.DataDefineOne(r,i.define)),t&&(this.addon.items.callbacks.get.forEach((t=>t(this,e,r))),this.addon.divhunt.Emit("addon.item.get",this,e,r)),r},GetData(e=!0){let t={};return Object.entries(t).forEach((([n,i])=>{t[n]=this.Get(n,e)})),t}},AddonItemRemove={Remove(e=!0){this.addon.ItemRemove(this.data.id,e)}},AddonItemSet={Set(e,t,n=!0){const i=this.addon.FieldGet(e),r=this.addon.FieldGet("*");if(!i&&!r)return;const s=this.data[e];i?.set?.forEach((e=>{t=e(t,s,this)})),r?.set?.forEach((e=>{t=e(t,s,this)})),i?.define?t=this.addon.divhunt.DataDefineOne(t,i.define):r?.define&&(t=this.addon.divhunt.DataDefineOne(t,r.define)),n&&(this.addon.items.callbacks.set.forEach((n=>n(this,e,t))),this.addon.divhunt.Emit("addon.item.set",this,e,t,s)),this.data[e]=t},SetData(e,t=!0){Object.entries(e).forEach((([e,n])=>{this.Set(e,n,t)}))}};class DivhuntAddonItem{constructor(e,t){this.addon=e,this.data=t}}Object.assign(DivhuntAddonItem.prototype,AddonItemGet),Object.assign(DivhuntAddonItem.prototype,AddonItemSet),Object.assign(DivhuntAddonItem.prototype,AddonItemRemove),Object.assign(DivhuntAddonItem.prototype,AddonItemFunctions),Object.assign(DivhuntAddonItem.prototype,AddonItemCrud);class DivhuntAddonRender{constructor(e){this.addon=e,this.data=data}}const AddonClone={Clone(){try{const e=new DivhuntAddon(this.divhunt(),this.name+"_clone");e.__fields={},Object.values(this.__fields).forEach((t=>{e.__fields[t.name]={name:t.name,define:t.define,get:[],set:[]},t.get.forEach((n=>{e.__fields[t.name].get.push(n)})),t.set.forEach((n=>{e.__fields[t.name].set.push(n)}))})),e.__fields_callbacks={add:[...this.__fields_callbacks.add],remove:[...this.__fields_callbacks.remove]},e.__items={},e.__items_id=this.__items_id,Object.values(this.__items).forEach((t=>{const n=Object.assign({},t.GetData());delete n.id,e.ItemAdd(n,null,!1)})),e.__items_callbacks={add:[...this.__items_callbacks.add],get:[...this.__items_callbacks.get],set:[...this.__items_callbacks.set],remove:[...this.__items_callbacks.remove]},e.__functions={},Object.entries(this.__functions).forEach((([t,n])=>{e.__functions[t]={callback:n.callback,before:[...n.before||[]],after:[...n.after||[]],trigger:n.trigger}}));try{this.divhunt.Hook("addon.clone",this,e)}catch(e){}return e}catch(e){throw e}}},AddonFields={Field(e,t=null,n=null,i=null,r=!1,s=!0){return this.FieldGet(e)||this.FieldAdd(e,t,n,i,r,s)},Fields(){return this.fields},FieldAdd(e,t=null,n=null,i=null,r=!1,s=!0){return e in this.fields.data||(this.fields.data[e]={name:e,define:null,get:[],set:[],map:r}),r&&(e in this.items.map||(this.items.map={}),this.items.map[e]={}),null!==t&&(this.fields.data[e].define=t),null!==n&&this.fields.data[e].get.push(n),null!==i&&this.fields.data[e].set.push(i),s&&(this.fields.callbacks.add.forEach((t=>t.call(this,this.fields.data[e]))),this.divhunt.Emit("addon.field.add",this,this.fields.data[e])),this.fields.data[e]},FieldGet(e){return this.fields.data[e]},FieldRemove(e,t=!0){e in this.fields&&(t&&(this.fields.callbacks.remove.forEach((t=>t.call(this,this.fields.data[e]))),this.divhunt.Emit("addon.field.remove",this,this.fields.data[e])),delete this.fields.data[e])},FieldOn(e,t){if(!(e in this.fields.callbacks))return this.LogWarn("Field catcher not found.",{name}),this;this.fields.callbacks[e].push(t)}},AddonFind={Find(e=null){const t={filters:[],sort:null,limit:10,page:0},n=["=","!=","<",">","<=",">=","LIKE","NOT LIKE","ILIKE","NOT ILIKE","IN","NOT IN"],i={};return null===e&&(e=this.divhunt.Dependency("knex")),i.limit=e=>{if("number"!=typeof e||0>=e)throw Error("Limit must be a positive number");return t.limit=e,i},i.page=e=>{if("number"!=typeof e||0>e)throw Error("Page must be a non-negative number");return t.page=e,i},i.sort=(e,n="asc")=>{if(!/^[a-zA-Z][a-zA-Z0-9_]{0,63}$/.test(e))throw Error("Invalid field name: "+e);if(n=n.toLowerCase(),!["asc","desc"].includes(n))throw Error('Sort direction must be "asc" or "desc"');return t.sort={field:e,direction:n},i},i.filter=(e,r,s="=",a="AND")=>{if(!/^[a-zA-Z][a-zA-Z0-9_]{0,63}$/.test(e))throw Error("Invalid field name: "+e);if(!n.includes(s))throw Error(`Invalid operator: ${s}. Allowed operators are: ${n.join(", ")}`);if(!1===["number","string","boolean"].includes(typeof r))throw Error("Value must be a string, number or boolean");return t.filters.push({field:e,value:r,operator:s,type:"AND"===a?"AND":"OR"}),i},i.many=async(n=!1)=>{const i=this.Table();try{const r=e(i.name).select(i.fields);return this.FindApplyFilters(r,t.filters),t.sort&&r.orderBy(t.sort.field,t.sort.direction),t.limit>0&&(r.limit(t.limit),t.page>0)&&r.offset(t.page*t.limit),(await r).map((e=>this.ItemAdd(e,null,!1,n)))}catch(e){throw this.divhunt.LogError("Find query failed",{query:t},e),e}},i.count=async()=>{const n=this.Table();try{const i=e(n.name).count("* as count");this.FindApplyFilters(i,t.filters);const r=await i;return parseInt(r[0]?.count||0)}catch(e){throw this.divhunt.LogError("Count query failed",{query:t},e),e}},i.one=async(e=!1)=>{const t=await i.limit(1).many(e);return t.length>0?t[0]:null},i},FindApplyFilters(e,t){t&&0!==t.length&&e.where((function(){t.forEach(((e,t)=>{const{field:n,value:i,operator:r,type:s}=e,a=0===t?"where":"OR"===s?"orWhere":"andWhere";if("IN"===r||"NOT IN"===r){const e=Array.isArray(i)?i:[i];this[a](n,r.toLowerCase(),e)}else this[a](n,r.toLowerCase(),i)}))}))}},AddonFunctions={FnAdd(e,t){if("object"==typeof e)return Object.entries(e).forEach((([e,t])=>this.FnAdd(e,t))),this;if(e=e.toLowerCase(),"function"!=typeof t)return this.divhunt.LogWarn('Function "'+e+'" callback is not a function.'),this;this.functions.data[e]={callback:t,name:e};try{this.functions.callbacks.add.forEach((t=>t.call(this,this.functions.data[e]))),this.divhunt.Emit("addon.function.add",e)}catch(t){this.divhunt.LogError('Error in function "'+e+'" callback add.',{},t)}return this},FnGet(e){return e=e.toLowerCase(),this.functions.data[e]||null},FnRun(e,...t){e=e.toLowerCase();const n=this.FnGet(e);if(!n)return this.divhunt.LogError("Function not found.",{name:e}),null;let i=null;const r=Object.create(this);r.methods={};try{this.functions.callbacks.before.forEach((e=>e.call(r,n,...t))),this.divhunt.Emit("addon.function.before",this,n,i,...t)}catch(t){this.divhunt.LogError("Error in function callback before.",{name:e},t)}try{i=n.callback.call(r,...t)}catch(t){this.divhunt.LogError("Error in function callback.",{name:e},t)}try{this.functions.callbacks.after.forEach((e=>e.call(r,n,i,...t))),this.divhunt.Emit("addon.function.after",r,n,i,...t)}catch(t){this.divhunt.LogError("Error in function callback after.",{name:e},t)}return i},FnRemove(e){const t=this.FnGet(e);if(!t)return this;try{this.functions.callbacks.remove.forEach((e=>e.call(this,t))),this.divhunt.Emit("addon.function.remove",this,t)}catch(e){this.divhunt.LogError("Error in function callback remove.",{name:t.name},e)}return delete this.functions.data[t.name],this},FnOn(e,t){if(!(e in this.functions.callbacks))return this.LogWarn("Item catcher not found.",{type:e});this.functions.callbacks[e].push(t)},Fn(e,...t){return!this.FnGet(e)&&t.length&&"function"==typeof t[0]?this.FnAdd(e,...t):this.FnRun(e,...t)}},AddonGet={GetName(){return this.name}},AddonItems={Item(e,t=null,n=null,i=!0){return e&&"object"==typeof e?this.ItemAdd(e,n,i):this.ItemGet(e,t,n)},Items(){return this.items.data},ItemGet(e,t=null,n=null){return t?t in this.items.map&&e in this.items.map[t]?this.ItemGet(this.items.map[t][e],null,n):null:e in this.items.data?(n&&n(this.items.data[e]),this.items.data[e]):null},ItemGetByMap(e,t=null){return e in this.items.data?(t&&t(this.items.data[e]),this.items.data[e]):null},ItemAdd(e,t=null,n=!0){this.FieldGet("id")||this.FieldAdd("id",["number"]);let i=new DivhuntAddonItem(this,{});return"id"in e||(e.id=this.items.id++),i.SetData(e,!1),n&&(this.items.callbacks.add.forEach((e=>e.call(this,i))),this.divhunt.Emit("addon.item.add",this,i)),t&&t(i),this.items.data[i.Get("id")]=i,i},ItemRemove(e,t=!0){const n=this.ItemGet(e);n&&(Object.values(this.fields.data).forEach((e=>{e.map&&delete this.items.map[e.name][n.Get(e.name)]})),t&&(this.items.callbacks.remove.forEach((e=>e.call(this,n))),this.divhunt.Emit("addon.item.remove",this,n)),delete this.items.data[e])},ItemsRemove(e=!0){if(e)for(let t in this.items.data)this.ItemRemove(t,e);else this.items.data={}},ItemOn(e,t){if(!(e in this.items.callbacks))return this.LogWarn("Item catcher not found for: "+e+"."),this;this.items.callbacks[e].push(t)}},AddonRemove={Remove(e=!0){this.divhunt.AddonRemove(this.name,e)}},AddonRender={Render(e,t={},n={},i=null,r=null){return"function"==typeof t?this.RenderAdd(e,t,n,i,r):this.RenderRun(e,t,n,i,r)},RenderRun(e,t={},n={},i=null,r=null){return this.FnRun("render."+e,t,n,i,r)},RenderRemove(e){this.FnRemove("render."+e)},RenderAdd(e,t){return this.FnAdd("render."+e,((n,i,r,s)=>{const a=new DivhuntAddonRender(this);return a.SetName(e),a.SetCallback(t),a.SetData(n),a.SetAttributes(i),a.SetParent(r),a.SetItem(s),a.Process()})),this},RenderContext(e,t=null,n=null,i=null){const r={Self:{},Element:null,Nodes:[],Ready:!1};return r.Addon=this,r.Divhunt=this.divhunt,r.Parent=t,r.Item=n,r.Data={mount:[],unmount:[],compile:[],reload:[]},i&&i(r.Self,r),r.Reload=()=>{let e=r.Parent;if(e){for(;e.Parent;)e=e.Parent;e.Reload()}else{const e=this.RenderCompile(r.HTML,r);r.Element.replaceWith(e.element),r.Element=e.element,r.Nodes=e.nodes}},r.OnReload=e=>{r.Ready||r.Data.reload.push(e)},r.OnMount=e=>{r.Ready||r.Data.mount.push(e)},r.OnUnmount=e=>{r.Ready||r.Data.unmount.push(e)},r.OnCompile=(e,t="before")=>{r.Ready||r.Data.compile.push({trigger:t,callback:e})},r.Define=e=>{this.divhunt.DataDefine(r,e)},Object.assign(r,e),r},RenderCompile(e,t){const n=this.RenderElement(e,onMount,onUnmount),i={element:n,nodes:{},time:performance.now(),walk:!0,children:!0};for(let e in t.Attributes)n.setAttribute(e,t.Attributes[e]);n.className="r"+this.divhunt.GenerateHash(this.GetName()+"-"+t.Name)+(n.className?" "+n.className:"");const walk=(e,n)=>{i.walk&&(i.nodes[n]=e,this.divhunt.Emit("addon.render.node.before",t,i,e,n),t.Data.compile.forEach((t=>"node.before"===t.trigger&&t.callback(i,e,n))),i.children&&e&&e.nodeType===Node.ELEMENT_NODE&&e.hasChildNodes()&&(this.divhunt.Emit("addon.render.node.children.before",t,i,e,n),t.Data.compile.forEach((t=>"node.children.before"===t.trigger&&t.callback(i,e,n))),Array.from(e.childNodes).forEach(((e,t)=>walk(e,n+"-"+t))),this.divhunt.Emit("addon.render.node.children.after",t,i,e,n),t.Data.compile.forEach((t=>"node.children.after"===t.trigger&&t.callback(i,e,n)))),this.divhunt.Emit("addon.render.node.after",t,i,e,n),t.Data.compile.forEach((t=>"node.after"===t.trigger&&t.callback(i,e,n))))};return this.divhunt.Emit("addon.render.before",t,i),t.Data.compile.forEach((e=>"before"===e.trigger&&e.callback(i))),walk(n,identifier),this.divhunt.Emit("addon.render.after",t,i),t.Data.compile.forEach((e=>"after"===e.trigger&&e.callback(i))),i.time=performance.now()-i.time,i},RenderElement(e=null,t=null,n=null){const i=document.createElement("div");return e&&(i.innerHTML=e),i}},AddonTable={Table(e=null,t=[]){return null===e?this.TableGet():this.TableSet(e,t)},TableSet(e,t=[]){this.table.name=e,this.table.fields=t},TableGet(){return this.table},TableOn(e,t){e in this.table.callbacks&&this.table.callbacks.on(e,t)}};class DivhuntAddon{constructor(e,t){this.divhunt=e,this.name=t,this.table={name:null,fields:[],callbacks:{get:[],create:[],update:[],delete:[]}},this.fields={data:{},callbacks:{add:[],remove:[]}},this.functions={data:{},callbacks:{before:[],after:[],add:[],remove:[]}},this.items={data:{},map:{},id:1,callbacks:{add:[],remove:[],get:[],set:[]}}}}Object.assign(DivhuntAddon.prototype,AddonGet),Object.assign(DivhuntAddon.prototype,AddonFields),Object.assign(DivhuntAddon.prototype,AddonItems),Object.assign(DivhuntAddon.prototype,AddonRemove),Object.assign(DivhuntAddon.prototype,AddonFunctions),Object.assign(DivhuntAddon.prototype,AddonClone),Object.assign(DivhuntAddon.prototype,AddonTable),Object.assign(DivhuntAddon.prototype,AddonFind),Object.assign(DivhuntAddon.prototype,AddonRender);const Addons={Addon(e,t=null,n=!0){return this.AddonGet(e)?this.AddonGet(e,t):this.AddonAdd(e,t,n)},AddonAdd(e,t=null,n=!0){e=e.toLowerCase();const i=new DivhuntAddon(this,e);if(this.addons.data[e]=i,t&&t(i),n)try{this.addons.callbacks.add.forEach((e=>e(i))),this.Emit("addon.add",i)}catch(t){this.LogError("Error while performing addon add callback.",{addon:e},t)}return this.AddonGet(e)},AddonGet(e,t=null){return(e=e.toLowerCase())in this.addons.data?(t&&t(this.addons.data[e]),this.addons.data[e]):null},Addons(){return this.addons.data},AddonRemove(e,t=!0){const n=this.AddonGet(e);if(n){if(t)try{this.addons.callbacks.remove.forEach((e=>e(n))),this.Emit("addon.remove",n)}catch(t){this.LogError("Error while performing addon remove callback.",{addon:e},t)}n.ItemsRemove(t),delete this.addons.items[e]}},AddonsRemove(e=!0){for(let t in this.addons.items)this.AddonRemove(t,e)},AddonOn(e,t){if(!(e in this.addons.callbacks))return this.LogWarn("Addon catcher not found.",{addon:e});this.addons.callbacks[e].push(t)},AddonReady(e,t,n=!0){const i=this.AddonGet(e);if(i)return n?t(i):setTimeout((()=>t(i)));this.AddonOn("add",(i=>{if(i.GetName()===e)return n?t(i):setTimeout((()=>t(i)))}))}},Data={DataDefine(e,t,n=0){if(n>10)return this.LogError("Data definition depth limit reached.",{limit:10,data:e}),null;for(const[i,r]of Object.entries(t))e[i]=this.DataDefineOne(e[i],r,n+1);return e},DataDefineOne(e,t,n=0){const{type:i,defaultValue:r,required:s,nested:a}=this.DataParseConfig(t);if(this.DataTypeMatch(e,i)||(e=r&&this.DataTypeMatch(r,i)?this.DataPrimitiveValue(e,r):null),s&&null==e)return this.LogError(`Required field "${i}" is missing in data.`,{data:e}),null;if(!a)return e;if(i.includes("array")){Array.isArray(e)||(e=[]);const t=[];for(let i=0;e.length>i;i++){const r=this.DataDefineOne(e[i],a,n+1);null!=r&&t.push(r)}return t}return i.includes("object")?(e&&"object"==typeof e||(e={}),this.DataDefine(e,a,n+1)):e},DataParseConfig:e=>Array.isArray(e)?{type:(e[0]+"").toLowerCase(),defaultValue:e[1],required:e[2],nested:null}:e&&"object"==typeof e?{type:(e.type+"").toLowerCase(),defaultValue:e.value,required:e.required,nested:e.config}:{type:typeof e,defaultValue:e,required:!1,nested:null},DataTypeMatch:(e,t)=>("string"==typeof t?t.split("|").map((e=>e.trim().toLowerCase())):[]).some((t=>{const n=typeof e;return"array"===t?Array.isArray(e):"object"===t?"object"===n&&!Array.isArray(e)&&null!==e:t===n})),DataPrimitiveValue:(e,t=null)=>null==e||typeof e!=typeof t||Array.isArray(e)!==Array.isArray(t)?t:e,DataConfig(e){const t={};for(const[n,i]of Object.entries(e)){const{type:e,defaultValue:r,required:s,nested:a}=this.DataParseConfig(i);t[n]={type:e},null!=r&&(t[n].value=r),s&&(t[n].required=!0),a&&(t[n].config=this.DataConfig(a))}return t}},Dependencies={Dependency(e,t=null){return null===t?this.DependencyGet(e,!1):this.DependencyAdd(e,t)},Dependencies(){return this.dependencies.items},DependencyGet(e,t=!0){return this.DependencyHas(e)?t?this.dependencies.items[e]:this.dependencies.items[e].value:null},DependencyAdd(e,t,n=!0){const i=this.dependencies.items[e]={name:e,value:t};if(n)try{this.dependencies.callbacks.add.forEach((e=>e(i))),this.Emit("dependency.add",i)}catch(t){this.LogError("Error while performing dependency add callback.",{name:e},t)}return this},DependencyHas(e){return e in this.dependencies.items},DependencyRemove(e,t=!0){const n=this.DependencyGet(e);if(n){if(t)try{this.dependencies.callbacks.remove.forEach((e=>e(n))),this.Emit("dependency.remove",n)}catch(t){this.LogError("Error while performing dependency remove callback.",{name:e},t)}return delete this.dependencies.items[e],this}},DependencyOn(e,t){if(!(e in this.dependencies.callbacks))return this.LogWarn("Field catcher not found.",{type:e}),this;this.dependencies.callbacks[e].push(t)}},DOM={DOMCompare(e,t){if(!e||!t||e.nodeType!==t.nodeType||e.nodeName!==t.nodeName)return!1;if(e.nodeType===Node.TEXT_NODE)return e.textContent===t.textContent;if(e.attributes?.length!==t.attributes?.length)return!1;for(let n=0;(e.attributes?.length||0)>n;n++){const i=e.attributes[n].name;if(!t.hasAttribute(i)||e.getAttribute(i)!==t.getAttribute(i))return!1}if(e.childNodes.length!==t.childNodes.length)return!1;for(let n=0;e.childNodes.length>n;n++)if(!this.DOMCompare(e.childNodes[n],t.childNodes[n]))return!1;return!0},DOMPatch(e,t){if(!e||!t||e.nodeType!==t.nodeType||e.nodeName!==t.nodeName)return void(e&&e.parentNode&&t&&e.parentNode.replaceChild(t.cloneNode(!0),e));if(e.nodeType===Node.TEXT_NODE)return void(e.textContent!==t.textContent&&(e.textContent=t.textContent));const n=e.attributes,i=t.attributes;for(let i=(n?.length||0)-1;i>=0;i--){const r=n[i].name;t.hasAttribute(r)||e.removeAttribute(r)}for(let t=0;(i?.length||0)>t;t++){const n=i[t].name,r=i[t].value;e.hasAttribute(n)&&e.getAttribute(n)===r||e.setAttribute(n,r)}const r=e.childNodes,s=t.childNodes;if(0!==s.length){for(let t=0;s.length>t;t++)r.length>t?this.DOMPatch(r[t],s[t]):e.appendChild(s[t].cloneNode(!0));for(;r.length>s.length;)e.removeChild(e.lastChild)}else e.innerHTML=""},DOMUpdate(e,t){if(!e||"string"!=typeof t)return!1;const n=document.createElement("div");return n.innerHTML=t,!this.DOMCompare(e,n)&&(this.DOMPatch(e,n),!0)}},Emitter={Emit(e,...t){(e=e.toLowerCase())in this.emitters&&this.emitters[e].forEach((n=>{try{n.callback(...t),n.once&&this.EmitOff(e,n.id)}catch(t){this.LogError("Error in emitter callback.",{name:e,addon:this.GetName()},t)}}))},EmitOn(e,t){e=e.toLowerCase(),this.emitters[e]||(this.emitters[e]=[]);const n=this.GenerateUID();return this.emitters[e].push({id:n,once:!1,callback:t}),n},EmitOnce(e,t){e=e.toLowerCase(),this.emitters[e]||(this.emitters[e]=[]);const n=this.GenerateUID();return this.emitters[e].push({id:n,once:!0,callback:t}),n},EmitOff(e,t){(e=e.toLowerCase())in this.emitters&&(this.emitters[e]=this.emitters[e].filter((e=>e.id!==t)))}},Function={Function(e,t={}){if(!this.FunctionExpressionValid(e))return this.LogError("Invalid expression.",{expression:e},Error("Expression evaluation failed."));try{const n="undefined"!=typeof window?window.Function:global.Function,i=Object.keys(t),r=Object.values(t),s=`return ${e};`;return new n(...i,s)(...r)}catch(t){this.LogError("Expression evaluation failed.",{expression:e},t)}},FunctionExpressionValid(e){return!(e.includes(";")||e.includes("`")||e.includes("=>")||e.includes("return ")||!/^[a-zA-Z0-9_\[\]\.\'"+-\/*%<>=!&|\s()?,:\d]*$/.test(e)||["eval","Function","setTimeout","setInterval","execScript","constructor","prototype","__proto__","global","process","require","import","export","module","window","document","localStorage","sessionStorage","fetch","XMLHttpRequest","__dirname","__filename","Buffer","Promise","arguments","callee","caller","debugger","new","this","delete","bind","apply","call","Reflect","Proxy","revoke"].some((t=>RegExp(`\\b${t}\\b`,"i").test(e))))}},Generate={GenerateHash(e){let t=0;for(let n=0;e.length>n;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return Math.abs(t).toString(16)},GenerateUID:()=>Math.random().toString(36).slice(2,11),GenerateString(e=10,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"){let n="";const i=t.length;for(let r=0;e>r;r++)n+=t.charAt(Math.floor(Math.random()*i));return n},GenerateTID(){let e=Date.now(),t=(""+Math.floor(1e6*Math.random())).padStart(6,"0");return parseInt(`${e}${t}`)}},Logger={Log(e,t,n={}){if(!(e in this.logger.levels))throw Error(`Invalid log level: '${e}'`);return n.allowed=this.logger.levels[e]>=this.logger.levels[this.logger.level],n.timestamp=(new Date).toISOString(),n.level=e,n.message=t,this.Emit("log",n),this},LogLevel(e){if(!(e in this.logger.levels))throw Error(`Invalid log level: '${e}'`);return this},LogError(e,t={},n=null,i=1,r=!1){if(t.stack=n?n.stack.split("\n").splice(1,i):[],this.Log("error",e+(n?" / "+n.message:""),t),r)throw n||Error(e)},LogWarn(e,t={}){return this.Log("warn",e,t)},LogInfo(e,t={}){return this.Log("info",e,t)},LogVerbose(e,t={}){return this.Log("verbose",e,t)},LogDebug(e,t={}){return this.Log("debug",e,t)},LogSilly(e,t={}){return this.Log("silly",e,t)}},Middleware={async Middleware(e,t){let n=-1;const i={value:t,errors:[],next:async()=>{if(n++,this.middleware[e].length>n)try{return await this.middleware[e][n](i)}catch(t){this.LogError("Error in middleware callback: "+e,{},t)}return i}};return this.middleware[e]||(this.middleware[e]=[]),await i.next()},MiddlewareIntercept(e,t){return this.middleware[e]||(this.middleware[e]=[]),this.middleware[e].push(t),this}},Request={Request(e,t){e=e.toLowerCase();const n={value:t};return this.Emit("request."+e,n),"value"in n&&typeof n.value==typeof t?n.value:t},RequestCatch(e,t){e=e.toLowerCase(),this.EmitOn("request."+e,t)}},String={StringSanitize(e){const t="string"!=typeof e?JSON.stringify(e):e,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return t.replace(/[&<>"']/g,(e=>n[e]))},StringHasTemplateKey(e,t){if("string"!=typeof e||"string"!=typeof t)return!1;const n=/\{\{\s*([^}]+)\s*\}\}/g,i=RegExp(`(^|[^\\w.])${t.replace(/\./g,"\\.")}($|[^\\w])`);let r;for(;null!==(r=n.exec(e));){const e=r[1].trim();if(i.test(e))return!0}return!1},StringCompileTemplate:(e,t)=>"string"!=typeof e?"":t&&"object"==typeof t?e.replace(/\{\{\s*([^}]+)\s*\}\}/g,((e,n)=>{try{const i=n.trim().split(".");let r=t,s=0;const a=5;for(const t of i){if(null==r||s>a)return e;r=r[t],s++}return null!=r?r+"":e}catch(t){return e}})):e,StringExtractUnit(e,t="px"){const n=(e+"").match(/^(\d+)(%|px|em|rem|vh|vw|pt)?$/);return n?{value:parseInt(n[1],10),unit:n[2]||t}:{value:0,unit:t}},StringTruncate:(e,t=100,n="...")=>("string"!=typeof e&&(e+=""),e.length>t?e.slice(0,t-n.length)+n:e),StringCapitalize:e=>"string"==typeof e&&e.length?e.charAt(0).toUpperCase()+e.slice(1):"",StringToCamelCase(e){return"string"!=typeof e?"":e.replace(/[^\w\s]/g," ").split(/\s+/).filter((e=>e.length)).map(((e,t)=>0===t?e.toLowerCase():this.StringCapitalize(e.toLowerCase()))).join("")},StringStripHtml:e=>"string"!=typeof e?"":e.replace(/<style[^>]*>.*?<\/style>/gs,"").replace(/<script[^>]*>.*?<\/script>/gs,"").replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/\s+/g," ").trim(),StringSlugify:e=>"string"!=typeof e?"":e.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+|-+$/g,""),StringFormatNumber(e,t=2,n=".",i=","){if(isNaN(e))return"0";const r=parseFloat(e).toFixed(t).split(".");return r[0]=r[0].replace(/\B(?=(\d{3})+(?!\d))/g,i),r.join(n)}};class Divhunt{constructor(){this.emitters={},this.middleware={},this.addons={data:{},callbacks:{add:[],remove:[]}},this.dependencies={items:{},callbacks:{add:[],remove:[]}},this.logger={levels:{error:0,warn:1,info:2,http:3,verbose:4,debug:5,silly:6},level:"error"}}}Object.assign(Divhunt.prototype,Addons),Object.assign(Divhunt.prototype,Emitter),Object.assign(Divhunt.prototype,Generate),Object.assign(Divhunt.prototype,Request),Object.assign(Divhunt.prototype,Data),Object.assign(Divhunt.prototype,String),Object.assign(Divhunt.prototype,Middleware),Object.assign(Divhunt.prototype,Logger),Object.assign(Divhunt.prototype,Dependencies),Object.assign(Divhunt.prototype,Function),Object.assign(Divhunt.prototype,DOM);export default Divhunt;